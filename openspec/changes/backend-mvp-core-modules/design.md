## Context

当前后端仓库是 Spring Boot 初始化工程，尚无业务分层与数据库实体。根据项目概述，后端需要同时服务移动端（家长/学员）和管理后台，并支持学员、课程、考勤、体测等核心教务流程。为降低初期复杂度，本次先实现单体后端 MVP，确保接口可用、结构可扩展。

## Goals / Non-Goals

**Goals:**
- 建立标准分层架构（controller/service/repository/entity/dto）。
- 落地四大核心域（学员、课程、考勤、体测）的 CRUD/查询能力。
- 建立统一返回与异常处理机制，降低前端联调成本。
- 建立最小鉴权与 RBAC 骨架，为后续完整 JWT 登录流程预留。

**Non-Goals:**
- 不在本次实现完整用户系统（注册、登录、刷新令牌）。
- 不实现阿里云 OSS、消息推送、复杂排课冲突检测。
- 不实现复杂报表统计与可视化聚合分析。

## Decisions

### Decision 1: 使用 Spring Data JPA + MySQL 建模核心数据
- **Rationale**: 当前需求以标准事务型 CRUD 为主，JPA 可快速形成可维护的数据访问层。
- **Alternative**: MyBatis。可控性更高，但在 MVP 阶段会增加开发与维护成本。

### Decision 2: 按领域划分模块并引入 DTO
- **Rationale**: 避免直接暴露实体，降低接口与存储模型耦合，便于后续版本演进。
- **Alternative**: 直接返回实体。开发更快但后续兼容性差。

### Decision 3: 统一 API 响应与全局异常处理
- **Rationale**: 移动端与后台共用同一套错误语义，前端处理逻辑更稳定。
- **Alternative**: 控制器分别处理异常。重复代码多且不一致风险高。

### Decision 4: 安全能力先做骨架
- **Rationale**: 文档要求 JWT + RBAC，但完整鉴权链路依赖用户体系。本次先接入安全框架和受保护端点规则，后续可平滑扩展。
- **Alternative**: 暂不接入安全。会导致后续重构成本上升。

## Risks / Trade-offs

- [Risk] Spring Boot 4 与部分依赖版本兼容性问题 → **Mitigation**: 采用 starter 依赖并通过 `mvn test` 验证。
- [Risk] 领域模型初版字段不完整 → **Mitigation**: 优先保留文档中的核心字段，附加可扩展备注字段。
- [Risk] 安全骨架未包含完整登录流程 → **Mitigation**: 清晰标注占位能力并在后续变更中补齐。

## Migration Plan

1. 新增依赖与基础配置（JPA/Validation/OpenAPI）。
2. 引入通用层（响应包装、异常处理、时间审计基类）。
3. 逐域落地实体、仓储、服务、控制器（学员→课程→考勤→体测）。
4. 接入最小安全配置并定义受保护路由策略。
5. 运行测试与构建，修复编译/配置问题。

回滚策略：若线上验证失败，可回滚到上一提交；本变更不涉及数据迁移脚本，不会引起不可逆结构变更。

## Open Questions

- 用户体系的初始身份来源（后台创建/外部 SSO）待定。
- 课程与考勤是否需要强一致并发控制（例如重复签到防重）待后续明确。
- 体测指标字典（项目名称、单位标准）是否由平台统一维护待确认。
